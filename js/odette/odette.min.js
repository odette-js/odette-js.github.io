!function(n,t,e){"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?module.exports=e():n.Odette=e()}(this,"Odette",function(n){"use strict";var t,e="0.0.0",i="",r="definitions cannot fail due to errors",o="length",u="global",s="prototype",c=".",f=this||window,a=f.document,d=!0,h=!1,p=null,l=function(){},v=function(n){return function(t){return typeof t===n}},g=function(){return+new Date},y=function(n,t){for(var e=0,i=n&&n.slice(0),r=i&&i[o],u=[];r>e;)u[e]=t(i[e],e,i),e++;return u},E=v("string"),O=v("number"),m=v("function"),V=v("object"),S=function(n){return Array.isArray(n)},x=function(n){return(V(n)?JSON.stringify(n):m(n)?n.toString():n)+i},A=g(),R=function(n,t){return function(){return t.apply(n,arguments)}},w=function(n,t,e){var i,r=p;try{i=n()}catch(o){r=o,i=t?t(o,i):i}finally{i=e?e(r,i):i}return i},C=function(n,e){var i,r,u,s=b(n),f=b(e);return s===d?d:f===d?d:s===h&&f===h?(i=n.split(c),r=e.split(c),y(i,function(n,t){+n<+(r[t]||0)&&(u=d)}),1===i[o]&&3===r[o]?d:3===i[o]&&1===r[o]?h:(u===t&&r[o]>i[o]&&(u=d),!!u)):n<=e},D=function(n){return function(){return n}},T=function(n){var e=n.url,i=[];return V(n)?(H(n.query,function(n,e){n!==t&&(n=encodeURIComponent(x(n)),i.push(e+"="+n))}),i[o]&&(e+="?"),e+=i.join("&"),n.hash&&(n.hash=V(n.hash)?encodeURI(x(n.hash)):hash,e+="#"+n.hash)):e=n,e},b=function(n){var t,e=n;return O(e)?e:(e+=i,t=+e,t===t?t:1===e.split(c)[o])},I=function(n){var t,e,r,u,s,c=0,a=n,p=f.decodeURIComponent;for(E(a)||(a=a[LOCATION].search),"?"===a[0]&&(a=a.slice(1)),r=a.split("&"),t={};c<r[o];c++)e=r[c].split("="),e[0]&&(e[o]<2&&e[PUSH](i),u=e[1],u=p(u),"'"!==u[0]&&'"'!==u[0]||(u=u.slice(1,u[o]-1)),u===d+i&&(u=d),u===h+i&&(u=h),E(u)&&(s=+u,s==u&&s+i===u&&(u=s)),t[p(e[0])]=u);return t},N=function(n){throw new Error(n)},H=function(n,t,e){var i,r,o=n;if(V(o))if(S(o))y(o,t);else{r=[];for(i in o)o.hasOwnProperty(i)&&r.push(i);y(r,function(n){t.apply(e||this,[o[n],n,o])})}return o},W=function(n,t){return H(t,function(t,e){n[e]=t}),n},q=function(n){return w(function(){var t=n.document;return!!t},function(){return h})},j=[],U=function(n,i,c,v,S,x){function b(n,t){return this.SCOPED=d,this.CREATED_AT=g(),this.VERSION=n,this.application=this,this.missedDefinitions=[],this.definedAgainst=[],this}b[s].extend=function(n){return this.merge(this,n)},b[s].merge=W,b[s].each=H,b[s].extend({exception:N,destroy:l,wraptry:w,now:g,Odette:U,stringifyQuery:T,parseSearch:I,undefine:function(n){return this.missedDefinitions.push(n),this.defining&&n.apply(this,[this,this.definingAgainst,this.definingWith]),this},parody:function(n){for(var t=this,e=0,i={},r=t[u];e<n[o];e++)i[n[e]]=R(r,r[n[e]]);return t.extend(i),t},scope:function(n,t){var e=n&&E(n)?n:this.VERSION,i=n&&(m(n)?n:m(t)?t:p);return this[u].scope(e,i)},block:function(n){return n.apply(this,[this])},counter:function(n){return U.counter(n)},definition:function(n,t){var e,i,o,u=this;return u.definedAgainst.indexOf(n)>-1?u:(u.definedAgainst.push(n),e=n.Odette,o=t||{},u.defined?y(u.missedDefinitions,function(t){t.apply(u,[u,n,o])}):(i=j.slice(0),j=[],y(i,function(t){u.defining&&N(r),u.defining=d,u.definingAgainst=n,u.definingWith=o,w(function(){t.handler.apply(u,[u,n,o]),u.defining=h,u.defined=d})})),u.defining&&N(r),u)}});var k=function(n,t){var e={};return function(i){var r,o=i||l,u=n,s=this,c=this.global,f=c.buildContext,a=function(){r.queue.push(p)},p={app:s,context:f,handler:o};return E(u)&&(u=D(u)),(u=u(s))?(r=e[u]=e[u]||{},r.finished?(t.apply(c,[p]),o.apply(p,[s])):r.loading?a():(r.queue=[],r.loading=d,a(),c.makeScript(u,function(){var n=r.queue.slice(0);r.loading=h,r.finished=d,r.queue=[],c.registerVersion(s.VERSION),c.map(n,function(n){t.apply(c,[n]),n.handler(n.app)})},f.document)),r.queue):h}};w(function(){var n;y(x,function(t){!f[i]&&q(t)&&t[i]&&(n=d,f[i]=t[i])})});var L,P=[],_=f[i]=f[i]||function(){return U.where.push(i),{Application:b,Odette:U,LOADED_CONTEXT:window,EXECUTED_AT:A,WHERE:i,VERSION:e,SHARED:d,SCOPED:h,versionOrder:[],versions:{},wraptry:w,maxVersion:C,map:y,loadScriptWithQueue:k,loadedAgainst:[n],queue:function(n,t){return P.push({context:n,handler:t}),this},emptyQueue:function(n){var t=P.slice(0),e=this,i=e.scope();return P=[],y(t,n||function(n){n.handler.apply(n.context,[e,i])}),e},registerVersion:function(n,t){var e=this,i=e.versions[n],r=e.versions[n]=i||t||new b(n,e);return r[u]=e,e.currentVersion=n,e.defaultVersion=e.maxVersion(e.defaultVersion,n)?n:e.defaultVersion,i||e.versionOrder.push(n),r},definition:function(n,t,e){var i,r=this,o=n,u=t,s=e;return V(o)&&(s=u,u=o,o=r.scope().VERSION),i=r.registerVersion(o),i.definition(u,s)},unRegisterVersion:function(n){var e=this,i=e.versions[n],r=e.versionOrder.indexOf(n);return r===-1?e:(i.destroy(),e.versionOrder.splice(r,1),i[u]=t,e.versions[n]=t,i)},scope:function(n,t){var e,i,r,o=this,u=o.versions;return E(n)||O(n)?(e=n,i=t):(i=n,e=o.defaultVersion),u[e]?o.currentVersion=e:o.registerVersion(e),r=u[e],m(i)?(r.block(i),r):r},hoist:function(n,t){var e=this,i=t||window;return n?n===this.LOADED_CONTEXT?d:e.loadedAgainst.indexOf(n)+1?d:e.touch(n)?(n[e.WHERE]&&(i[e.WHERE]=n[e.WHERE]),i[e.WHERE]):h:h},registerScopedMethod:function(n,t){var e=this,i=t||3;e[n]=e[n]||function(){var t=0,r=arguments,u=r,s=r[o],c=r[0];if(s<i)c=e.currentVersion;else{for(u=[];t<r[o];t++)u.push(r[t]);c=u.shift()}e.applyTo(c,n,u)};return e},get:function(n){return this.versions[n]},applyTo:function(n,t,e){var i=this,r=i.get(n);return r&&r[t]&&r[t].apply(r,e)},getCurrentScript:function(n){var t=(n||a).scripts,e=n.currentScript,i=t[t[o]-1];return e||i},touch:q,makeScript:function(n,t,e,i){var r=e||a,o=r.createElement("script");return o.type="text/javascript",i||r.head.appendChild(o),n&&(t&&(o.onload=t),E(n)?o.src=n:o.innerHTML=n.join("\n")),o}}}();return _.buildContext=n,L=_.get(c),L||(L=_.registerVersion(c),v.apply(f,[_,L])),S&&S.apply(f,[_,L]),L};return W(U,{VERSION:e,where:[],touchable:q,counter:function(){var n={},t=0;return function(e){var i;return e?(n[e]=n[e]||0,++n[e],i=n[e]):(++t,i=t),e?e+i:i}}(),definition:function(n,t){j.push({context:n,handler:t})}})});